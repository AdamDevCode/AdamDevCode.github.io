<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cake Ingredients Calculator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Cake Ingredients Calculator</h1>
    <div id="ingredients-list"></div>
    <button onclick="calculateTotal()">Calculate Total Cost</button>
    <button onclick="clearTotal()">Clear Total Cost</button>
    <h2 id="total-cost">Total Cost: £0.00</h2>

    <h2>Update Ingredient Price</h2>
    <div class="update-section">
        <label>
            Ingredient:
            <select id="ingredient-select">
                <!-- Options will be populated dynamically -->
            </select>
        </label>
        <label>
            Total Weight (grams):
            <input type="number" id="total-weight" min="0" step="0.1">
        </label>
        <label>
            Total Price (£):
            <input type="number" id="total-price" min="0" step="0.01">
        </label>
        <button onclick="updateIngredientPrice()">Update Price</button>
    </div>

    <h2>Add New Ingredient</h2>
    <div class="update-section">
        <label>
            Ingredient Name:
            <input type="text" id="new-ingredient-name">
        </label>
        <label>
            Unit:
            <input type="text" id="new-ingredient-unit">
        </label>
        <label>
            Total Weight (grams):
            <input type="number" id="new-total-weight" min="0" step="0.1">
        </label>
        <label>
            Total Price (£):
            <input type="number" id="new-total-price" min="0" step="0.01">
        </label>
        <button onclick="addNewIngredient()">Add Ingredient</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetchIngredients();
        });

        function fetchIngredients() {
            fetch('/ingredients')
                .then(response => response.json())
                .then(data => {
                    const ingredientsList = document.getElementById('ingredients-list');
                    ingredientsList.innerHTML = '';
                    data.forEach(ingredient => {
                        const ingredientDiv = document.createElement('div');
                        ingredientDiv.classList.add('ingredient');
                        ingredientDiv.innerHTML = `
                            <label>
                                ${ingredient.name} (${ingredient.unit}):
                                <input type="number" id="${ingredient.name}" name="${ingredient.name}" min="0" step="1">
                            </label>
                        `;
                        ingredientsList.appendChild(ingredientDiv);
                    });

                    const ingredientSelect = document.getElementById('ingredient-select');
                    ingredientSelect.innerHTML = '';
                    data.forEach(ingredient => {
                        const option = document.createElement('option');
                        option.value = ingredient.name;
                        option.textContent = ingredient.name;
                        ingredientSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error fetching ingredients:', error);
                    const ingredientsList = document.getElementById('ingredients-list');
                    ingredientsList.innerHTML = 'Error loading ingredients.';
                });
        }

        function calculateTotal() {
            const ingredients = document.querySelectorAll('.ingredient input');
            const selectedIngredients = [];

            ingredients.forEach(input => {
                const amount = parseFloat(input.value);
                if (amount > 0) {
                    selectedIngredients.push({ name: input.name, amount });
                }
            });

            fetch('/calculate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(selectedIngredients)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('total-cost').textContent = `Total Cost: £${data.totalCost.toFixed(2)}`;
            })
            .catch(error => {
                console.error('Error calculating total cost:', error);
            });
        }

        function clearTotal() {
            document.getElementById('total-cost').textContent = 'Total Cost: £0.00';
        }

        function updateIngredientPrice() {
            const name = document.getElementById('ingredient-select').value;
            const totalWeight = parseFloat(document.getElementById('total-weight').value);
            const totalPrice = parseFloat(document.getElementById('total-price').value);

            fetch('/update-ingredient', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name, totalWeight, totalPrice })
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    alert(data.message);
                    fetchIngredients();
                } else {
                    alert('Error updating ingredient');
                }
            })
            .catch(error => {
                console.error('Error updating ingredient:', error);
            });
        }

        function addNewIngredient() {
            const name = document.getElementById('new-ingredient-name').value;
            const unit = document.getElementById('new-ingredient-unit').value;
            const totalWeight = parseFloat(document.getElementById('new-total-weight').value);
            const totalPrice = parseFloat(document.getElementById('new-total-price').value);

            fetch('/add-ingredient', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name, unit, totalWeight, totalPrice })
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    alert(data.message);
                    fetchIngredients();
                } else {
                    alert('Error adding ingredient');
                }
            })
            .catch(error => {
                console.error('Error adding ingredient:', error);
            });
        }
    </script>
</body>
</html>
